---
title: "Lab 02 - Pacific Division"
author: "Drew Radovich"
date: "2025-04-06"
output: 
  github_document:
    toc: true
    toc_depth: 3
    preserve_yaml: true
  rmdformats::downcute:
    toc_depth: 3
    self_contained: true
    thumbnails: false
    lightbox: true
    gallery: false
    highlight: "tango"
    code_folding: show
always_allow_html: true
knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, encoding = encoding,
  output_format = "all") })
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Library

```{r, warning=FALSE, message=FALSE, results='hide'}
# Load packages
library(here)        # relative filepaths for reproducibility
library(tidyverse)   # data wrangling
library(stringi)     # string wrangling
library(kableExtra)  # table formatting
library(tidycensus)  # census data
```


```{r, warning=FALSE, message=FALSE, results='hide'}
# Load API key, assign to TidyCensus Package
source(here::here("analysis/password.R"))
census_api_key(census_api_key)
```


```{r, warning=FALSE, message=FALSE, results='hide'}
import::here( "author",
              "census_division",
              "fips",
              "fips_census_regions",
              "fips_region_assignment",
              "rank_variables",
              "svi_theme_variables",
              "svi_theme_flags",
             # notice the use of here::here() that points to the .R file
             # where all these R objects are created
             .from = here::here("analysis/project_data_steps_radovich.R"),
             .character_only = TRUE)
```

## Data

```{r}
# Load SVI data sets
svi_2010 <- readRDS(here::here("data/raw/Census_Data_SVI/svi_2010_trt10.rds"))
svi_2020 <- readRDS(here::here("data/raw/Census_Data_SVI/svi_2020_trt10.rds"))
```


```{r}
# Preview 2010 data
svi_2010 %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```

## Data Wrangling

```{r}
# Add FIPS data
svi_2010 <- fips_region_assignment(svi_2010)

svi_2010 %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```

```{r}
svi_2020 <- fips_region_assignment(svi_2020)

svi_2020 %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```




```{r}
# National 2010
svi_2010_national <- rank_variables(svi_2010)
svi_2010_national %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```


```{r}
# National 2020
svi_2020_national <- rank_variables(svi_2020)
svi_2020_national %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```


```{r}
# Regional 2010
svi_2010_regional <- rank_variables(svi_2010, rank_by = "regional", location = "West Region")
svi_2010_regional %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```


```{r}
# Regional 2020
svi_2020_regional <- rank_variables(svi_2020, rank_by = "regional", location = "West Region")
svi_2020_regional %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```

```{r}
# Divisional 2010
svi_2010_divisional <- rank_variables(svi_2010, rank_by = "divisional", location = "Pacific Division") 
svi_2010_divisional %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```


```{r}
# Divisional 2020
svi_2020_divisional <- rank_variables(svi_2020, rank_by = "divisional", location = "Pacific Division")
svi_2020_divisional %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```


```{r}
# State 2010 - WA
svi_2010_state <- rank_variables(svi_2010, rank_by = "state", location = "WA")
svi_2010_state %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```


```{r}
# State 2020 - WA
svi_2020_state <- rank_variables(svi_2020, rank_by = "state", location = "WA")
svi_2020_state %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```


```{r}
# County 2010 - King County
svi_2010_county <- rank_variables(svi_2010, rank_by = "county", location = "King County", state_abbr = "WA")
svi_2010_county %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```


```{r}
# County 2020 - King County
svi_2020_county <- rank_variables(svi_2020, rank_by = "county", location = "King County", state_abbr = "WA")
svi_2020_county %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```


```{r}
# Add theme variables
svi_2020_national <- svi_theme_variables(svi_2020_national)
svi_2020_national %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```


```{r}
# Add theme flags
svi_2020_national <- svi_theme_flags(svi_2020_national, .90)
svi_2020_national %>% arrange(desc(F_TOTAL)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```

```{r}
#Add theme variables 2010
svi_2010_national <- svi_theme_variables(svi_2010_national)
svi_2010_national %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```



```{r}
# Add theme flags
svi_2010_national <- svi_theme_flags(svi_2010_national, .90)
svi_2010_national %>% arrange(desc(F_TOTAL)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```


## Lab Questions

### **1. From a data science project management standpoint, how do you believe that functions are most useful? Can you think of scenarios in your current work or previous data projects where it would have been helpful to implement functions? Can you think of scenarios where functions are not the most useful strategy for processing data?**

Functions are most useful when working with large data sets in which repeated data wrangling steps are needed to analyze subsets of that data. In this case, functions are useful for creating multiple iterations of a data set based on defined inputs, lessening the steps needed to clean and filter data.

There are some cases when functions are not the most useful strategy when working with smaller projects where a function might over-complicate the work needed. If a script does not need to be repeated, it is not necessary to create a function for it, such as loading data steps.

### **2. Describe the CDC SVI index. What is it and how do we intend to use it for our project? (Type your response)**

The CDC SVI index identifies the social vulnerability of a region based on four categories: socioeconomic status, household characteristics, racial & ethnic minority status, and housing type & transportation. We are using this measurement to compare social vulnerability in 2010 and 2020 for the same census tracts to estimate the impact of different tax credit programs. If the social vulnerability decreases over time, the tax credit program is effective.

### **3. Nationally, what are the most & least vulnerable tracts by THEME1, THEME2, THEME3, THEME4, OVERALL for 2020 and 2010. (Show code/data output to display your findings)**

#### Most Vulnerable

```{r}
# Most Vulnerable Tracts - Nationally
# THEME1 - 2010
svi_2010_national %>% arrange(desc(F_THEME1)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")

#THEME1 - 2020
svi_2020_national %>% arrange(desc(F_THEME1)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")

```


```{r}
# Most Vulnerable Tracts - Nationally
# THEME2 - 2010
svi_2010_national %>% arrange(desc(F_THEME2)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")

#THEME2 - 2020
svi_2020_national %>% arrange(desc(F_THEME2)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```


```{r}
# Most Vulnerable Tracts - Nationally
# THEME3 - 2010
svi_2010_national %>% arrange(desc(F_THEME3)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")

#THEME3 - 2020
svi_2020_national %>% arrange(desc(F_THEME3)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```


```{r}
# Most Vulnerable Tracts - Nationally
# THEME4 - 2010
svi_2010_national %>% arrange(desc(F_THEME4)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")

#THEME4 - 2020
svi_2020_national %>% arrange(desc(F_THEME4)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```


```{r}
# Most Vulnerable Tracts - Nationally
# TOTAL - 2010
svi_2010_national %>% arrange(desc(F_THEME1)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")

# TOTAL - 2020
svi_2020_national %>% arrange(desc(F_THEME1)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```

#### Least Vulnerable

```{r}
# Least Vulnerable Tracts - Nationally
# THEME1 - 2010
svi_2010_national %>% arrange((F_THEME1)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")

# THEME1 - 2020
svi_2020_national %>% arrange((F_THEME1)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")

```


```{r}
# Least Vulnerable Tracts - Nationally
# THEME2 - 2010
svi_2010_national %>% arrange((F_THEME2)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")

# THEME2 - 2020
svi_2020_national %>% arrange((F_THEME2)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```


```{r}
# Least Vulnerable Tracts - Nationally
# THEME3 - 2010
svi_2010_national %>% arrange((F_THEME3)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")

# THEME3 - 2020
svi_2020_national %>% arrange((F_THEME3)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```


```{r}
# Least Vulnerable Tracts - Nationally
# THEME4 - 2010
svi_2010_national %>% arrange((F_THEME4)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")

# THEME4 - 2020
svi_2020_national %>% arrange((F_THEME4)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```


```{r}
# Least Vulnerable Tracts - Nationally
# TOTAL - 2010
svi_2010_national %>% arrange((F_TOTAL)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")

# TOTAL - 2020
svi_2020_national %>% arrange((F_TOTAL)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")

```


### **4. For your division, what are the most & least vulnerable tracts by THEME1, THEME2, THEME3, THEME4, OVERALL. Do they belong to certain divisions/states? (Show code/data output to display your findings)**

```{r}
# Add theme variables
svi_2010_divisional <- svi_theme_variables(svi_2010_divisional)
svi_2020_divisional <- svi_theme_variables(svi_2020_divisional)
```


```{r}
# Add theme flags
svi_2010_divisional <- svi_theme_flags(svi_2010_divisional, .90)
svi_2020_divisional <- svi_theme_flags(svi_2020_divisional, .90)
```


#### Most Vulnerable

```{r}
# Most Vulnerable Tracts - Divisional
# THEME1 - 2010
svi_2010_divisional %>% filter(division == "Pacific Division") %>%arrange(desc(F_THEME1)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")

# THEME1 - 2020
svi_2020_divisional %>% filter(division == "Pacific Division")%>% arrange(desc(F_THEME1)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```
The most vulnerable tracts for THEME1 are Alameda, Kern, and Los Angeles County for 2010 and solely Los Angeles County in 2020.

```{r}
# Most Vulnerable Tracts - Divisional
# THEME2 - 2010
svi_2010_divisional %>% arrange(desc(F_THEME2)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")

# THEME2 - 2020
svi_2020_divisional %>% arrange(desc(F_THEME2)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```
In 2010, Fresno, Kern, Los Angeles, Sacramento, and San Bernardino Counties are the most vulnerable for THEME2. In 2020 it is Fresno, Imperial, and Los Angeles County.

```{r}
# Most Vulnerable Tracts - Divisional
# THEME3 - 2010
svi_2010_divisional %>% arrange(desc(F_THEME3)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")

# THEME3 - 2020
svi_2020_divisional %>% arrange(desc(F_THEME3)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```
The most vulnerable tracts for THEME3 are all located in Alaska for both 2010 and 2020.

```{r}
# Most Vulnerable Tracts - Divisional
# THEME4 - 2010
svi_2010_divisional %>% arrange(desc(F_THEME4)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")

# THEME4 - 2020
svi_2020_divisional %>% arrange(desc(F_THEME4)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```
The most vulnerable tracts for THEME4 are Kern and Los Angeles County for 2010 and 2020.

```{r}
# Most Vulnerable Tracts - Divisional
# TOTAL - 2010
svi_2010_divisional %>% arrange(desc(F_TOTAL)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")

# TOTAL - 2020
svi_2020_divisional %>% arrange(desc(F_TOTAL)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```
The most vulnerable tracts overall are located in Kern, Los Angeles, and Fresno County.


#### Least Vulnerable

```{r}
# Least Vulnerable Tracts - Divisional
# THEME1 - 2010
svi_2010_divisional %>% arrange((F_THEME1)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")

# THEME1 - 2020
svi_2020_divisional %>% arrange((F_THEME1)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```
The least vulnerable tracts are Aleutians West Census Area and Anchorage Municipality in Alaska.

```{r}
# Least Vulnerable Tracts - Divisional
# THEME2 - 2010
svi_2010_divisional %>% arrange((F_THEME2)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")

# THEME2 - 2020
svi_2020_divisional %>% arrange((F_THEME2)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```
The least vulnerable tracts are in Aleutians and Anchorage, Alaska.

```{r}
# Least Vulnerable Tracts - Divisional
# THEME3 - 2010
svi_2010_divisional %>% arrange((F_THEME3)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")

# THEME3 - 2020
svi_2020_divisional %>% arrange((F_THEME3)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```
The least vulnerable tracts for THEME3 are Aleutians East, Aleutians West, and Anchorage Municipality.

```{r}
# Least Vulnerable Tracts - Divisional
# THEME4 - 2010
svi_2010_divisional %>% arrange((F_THEME4)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")

# THEME4 - 2020
svi_2020_divisional %>% arrange((F_THEME4)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```
The least vulnerable tracts for THEME4 are all located in Anchorage Municipality.  

```{r}
# Least Vulnerable Tracts - Divisional
# TOTAL - 2010
svi_2010_divisional %>% arrange((F_TOTAL)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")

# TOTAL - 2020
svi_2020_divisional %>% arrange((F_TOTAL)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```
The least vulnerable tracts as a whole are located in Anchorage Municipality, AK.

### **5. For the most vulnerable state in your division, what are the most & least vulnerable tracts by THEME1, THEME2, THEME3, THEME4, OVERALL? Do they belong to certain counties? (Show code/data output to display your findings)**


```{r}
# State 2010 - CA
svi_2010_state <- rank_variables(svi_2010, rank_by = "state", location = "CA")

# State 2020 - CA
svi_2020_state <- rank_variables(svi_2020, rank_by = "state", location = "CA")
```


```{r}
# Add theme variables
svi_2010_state <- svi_theme_variables(svi_2010_state)
svi_2020_state <- svi_theme_variables(svi_2020_state)
```


```{r}
# Add theme flags
svi_2010_state <- svi_theme_flags(svi_2010_state, .90)
svi_2020_state <- svi_theme_flags(svi_2020_state, .90)
```

#### Most Vulnerable

```{r}
# Most Vulnerable Tracts - State
# THEME1 - 2010
svi_2010_state %>% arrange(desc(F_THEME1)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")

# THEME1 - 2020
svi_2020_state %>% arrange(desc(F_THEME1)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```
In 2010, Kern and Los Angeles County are the most vulnerable tracts for THEME1. In 2020, Fresno County replaces Kern County.

```{r}
# Most Vulnerable Tracts - State
# THEME2 - 2010
svi_2010_state %>% arrange(desc(F_THEME2)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")

# THEME2 - 2020
svi_2020_state %>% arrange(desc(F_THEME2)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```
For 2010, the most vulnerable tracts for THEME2 are located in Kern, San Bernardino, and San Francisco County. In 2020, they are in Fresno, Imperial, and Los Angeles County.

```{r}
# Most Vulnerable Tracts - State
# THEME3 - 2010
svi_2010_state %>% arrange(desc(F_THEME3)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")

# THEME3 - 2020
svi_2020_state %>% arrange(desc(F_THEME3)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```
The most vulnerable tracts for THEME3 are all in Alameda County.

```{r}
# Most Vulnerable Tracts - State
# THEME4 - 2010
svi_2010_state %>% arrange(desc(F_THEME4)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")

# THEME4 - 2020
svi_2020_state %>% arrange(desc(F_THEME4)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```
The most vulnerable tracts for THEME4 are in Alameda and Los Angeles County.

```{r}
# Most Vulnerable Tracts - State
# TOTAL - 2010
svi_2010_state %>% arrange(desc(F_TOTAL)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")

# TOTAL - 2020
svi_2020_state %>% arrange(desc(F_TOTAL)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```
The most vulnerable tracts in total are located in Kern County and Los Angeles County for 2010, with Fresno County replacing Kern County in 2020.

#### Least Vulnerable

```{r}
# Least Vulnerable Tracts - State
# THEME1 - 2010
svi_2010_state %>% arrange((F_THEME1)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")

# THEME1 - 2020
svi_2020_state %>% arrange((F_THEME1)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```
The least vulnerable tracts for THEME1 are located in Alameda County, CA.

```{r}
# Least Vulnerable Tracts - State
# THEME2 - 2010
svi_2010_state %>% arrange((F_THEME2)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")

# THEME2 - 2020
svi_2020_state %>% arrange((F_THEME2)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```
The least vulnerable tracts for THEME2 are located in Alameda County, CA, with only two tracts changing from 2010 to 2020.

```{r}
# Least Vulnerable Tracts - State
# THEME3 - 2010
svi_2010_state %>% arrange((F_THEME3)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")

# THEME3 - 2020
svi_2020_state %>% arrange((F_THEME3)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```
The least vulnerable tracts are in Alameda County, CA.

```{r}
# Least Vulnerable Tracts - State
# THEME4 - 2010
svi_2010_state %>% arrange((F_THEME4)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")

# THEME4 - 2020
svi_2020_state %>% arrange((F_THEME4)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```
The least vulnerable tracts for THEME4 are located in Alameda County, CA.

```{r}
# Least Vulnerable Tracts - State
# TOTAL - 2010
svi_2010_state %>% arrange((F_TOTAL)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")

# TOTAL - 2020
svi_2020_state %>% arrange((F_TOTAL)) %>% head() %>% kbl() %>% kable_styling() %>% scroll_box(width = "100%")
```

The total least vulnerable tracts are in Alameda County, CA with little to no changes from 2010 to 2020.